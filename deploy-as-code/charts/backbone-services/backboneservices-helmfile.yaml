environments:
  uat:
    values:
      - ../environments/env-secrets.yaml
      - ../environments/env.yaml
---
repositories:
- name: bitnami
  url: https://charts.bitnami.com/bitnami

templates: 
  default: &default
    chart: ./{{`{{ .Release.Name }}`}}
    namespace: backbone
    missingFileHandler: Warn

releases:
- name: cert-manager
  installed: true
  version: v1.13.3
  <<: *default
  disableValidation: true
  values:
    {{- if hasKey .Values "cert-manager" }}
    - {{ toYaml (index .Values "cert-manager") | nindent 6 }}
    {{- end }}

- name: minio
  installed: false
  version: 13.3.1
  <<: *default
  values:
    {{- if hasKey .Values "minio" }}
    - {{ toYaml (index .Values "minio") | nindent 6 }}
    {{- end }}

- name: postgresql
  installed: false
  version: 11.9.13
  <<: *default
  values:
    {{- if hasKey .Values "postgresql" }}
    - {{ toYaml (index .Values "postgresql") | nindent 6 }}
    {{- end }}
    - global:
        postgresql:
          auth:
            postgresPassword: {{ .Values.secrets.db.password | quote }}

- name: redis
  installed: true
  version: 7.2.4
  <<: *default
  values:
    {{- if hasKey .Values "redis" }}
    - {{ toYaml (index .Values "redis") | nindent 6 }}
    {{- end }}

- name: elasticsearch
  version: 8.11.3
  <<: *default
  values:
    {{- if hasKey .Values "elasticsearch" }}
    - {{ toYaml (index .Values "elasticsearch") | nindent 6 }}
    {{- end }}
    - secret:
        password: {{ .Values.secrets.elasticsearch.password }}

- name: elasticsearch-data
  version: 8.11.3
  <<: *default
  values:
    {{- if hasKey .Values "elasticsearch-data" }}
    - {{ toYaml (index .Values "elasticsearch-data") | nindent 6 }}
    {{- end }}

- name: kibana
  version: 8.11.3
  force: true
  <<: *default
  values:
    {{- if hasKey .Values "kibana" }}
    - {{ toYaml (index .Values "kibana") | nindent 6 }}
    {{- end }}
    - ingress:
        hosts:
          - host: {{ .Values.global.domain }}
            paths:
              - path: /kibana
        tls: 
          - secretName: {{ .Values.global.domain }}-tls-certs
            hosts:
              - {{ .Values.global.domain }}

- name: kafka-kraft
  installed: true
  version: 26.2.0
  <<: *default
  values:
    {{- if hasKey .Values "kafka-kraft" }}
    - {{ toYaml (index .Values "kafka-kraft") | nindent 6 }}
    {{- end }}
  set:
    - name: kraft.clusterId
      value: {{ .Values.secrets.kafka.clusterID }}

- name: ingress-nginx
  installed: true
  version: 4.10.0
  <<: *default
  values:
    - domain: {{ .Values.global.domain }}
    {{- if hasKey .Values "ingress-nginx" }}
    - {{ toYaml (index .Values "ingress-nginx") | nindent 6 }}
    {{- end }}

- name: playground
  installed: true
  version: 0.1.0
  <<: *default
  values:
    {{- if hasKey .Values "playground" }}
    - {{ toYaml (index .Values "playground") | nindent 6 }}
    {{- end }}