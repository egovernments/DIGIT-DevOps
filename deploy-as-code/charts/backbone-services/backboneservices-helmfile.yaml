environments:
  uat:
    values:
      - ../environments/env-secrets.yaml
      - ../environments/env.yaml
---
repositories:
- name: bitnami
  url: https://charts.bitnami.com/bitnami

templates: 
  default: &default
    chart: ./{{`{{ .Release.Name }}`}}
    namespace: backbone
    missingFileHandler: Warn

releases:
  - name: cert-manager
    installed: true
    version: v1.13.3
    <<: *default
    disableValidation: true
    values:
    - {{ .Values | toYaml | nindent 8 }}

  - name: minio
    installed: false
    version: 13.3.1
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}

  - name: postgresql
    installed: false
    version: 11.9.13
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}
    - global:
        postgresql:
          auth:
            postgresPassword: {{ .Values.secrets.db.password | quote }}

  - name: redis
    installed: true
    version: 7.2.4
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}

  - name: elasticsearch
    version: 8.11.3
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}
    - secret:
        password: {{ .Values.secrets.elasticsearch.password }}

  - name: elasticsearch-data
    version: 8.11.3
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}

  - name: kibana
    version: 8.11.3
    force: true
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}
    - ingress:
        hosts:
          - host: {{ .Values.global.domain }}
            paths:
              - path: /kibana
        tls:
          - secretName: {{ .Values.global.domain }}-tls-certs
            hosts:
              - {{ .Values.global.domain }}

  - name: kafka-kraft
    installed: true
    version: 26.2.0
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}
    set:
      - name: kraft.clusterId
        value: {{ .Values.secrets.kafka.clusterID }}

  - name: ingress-nginx
    installed: true
    version: 4.10.0
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}

  - name: playground
    installed: true
    version: 0.1.0
    <<: *default
    values:
    - {{ .Values | toYaml | nindent 8 }}